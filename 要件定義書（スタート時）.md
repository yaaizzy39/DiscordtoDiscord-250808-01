
## 🧩 プロジェクト名
DiscordToDiscord

---

```markdown
# 📦 要件定義書：Discordメッセージ → Webhook転送 Chrome拡張

## 🧩 プロジェクト名
DiscordToWebhookExtension

---

## 🎯 概要

このChrome拡張は、**Discordの各メッセージにボタンを追加し、そのボタンを押すことで該当メッセージの本文とリンクを指定されたDiscord Webhookへ転送する**機能を提供します。

---

## 🧑‍💻 想定ユーザー

- 自身が管理するDiscordサーバーにログを送信したいユーザー
- Webhook URLの取得・設定ができるユーザー

---

## 🔐 前提・制約

- ユーザーが自前でDiscord Webhookを取得し、拡張機能に登録
- Webhook URLは外部送信されず、ローカルストレージに保存
- 対応サイトは `https://discord.com/channels/` 以下のページ
- Chrome Manifest V3 準拠
- 権利上の都合で他ユーザーのメッセージ転送には**注意喚起表示**を行う

---

## 📁 ディレクトリ構成（提案）

```

/DiscordToWebhookExtension
├── manifest.json
├── content.js
├── popup.html
├── popup.js
├── styles.css
└── utils/
└── webhook.js

````

---

## 🛠️ 機能要件

| ID  | 機能                         | 説明                                                                 | 実装ファイル              |
|-----|------------------------------|----------------------------------------------------------------------|---------------------------|
| F1  | メッセージ検出               | Discord DOMから各メッセージを検出し処理対象にする                   | content.js                |
| F2  | ボタン挿入                   | 各メッセージに「Send via Webhook」ボタンを追加                      | content.js                |
| F3  | メッセージ情報の取得         | ボタン押下時に本文・リンク・ユーザー名を抽出                        | content.js                |
| F4  | DiscordへのWebhook送信       | 抽出した情報をWebhook経由で指定チャンネルに送信                     | utils/webhook.js          |
| F5  | Webhook設定UI                | Webhook URLの保存・入力UI                                           | popup.html / popup.js     |
| F6  | ストレージ管理               | Webhook URLの保存・取得機能                                         | popup.js / content.js     |
| F7  | 成功/失敗通知表示            | メッセージ転送成功/失敗時の通知                                     | content.js                |
| F8  | 他人のメッセージ警告表示     | 自分以外のユーザーのメッセージを転送する際は確認ダイアログを表示    | content.js                |

---

## 📤 Discord 送信フォーマット（Webhook Payload）

```json
{
  "embeds": [
    {
      "title": "Forwarded Discord Message",
      "description": "<メッセージ本文>",
      "url": "<元メッセージへのリンク（可能な限り）>",
      "footer": {
        "text": "Shared via Chrome Extension"
      }
    }
  ]
}
````

> メッセージのURL取得にはスレッド・チャンネルID・メッセージIDの取得が必要。URLは構造的に以下：
> `https://discord.com/channels/<guild_id>/<channel_id>/<message_id>`

---

## 🧷 DOM操作ガイドライン

* 各メッセージは `div[class*="messageContent"]` およびその親コンテナ（`article`など）を基点に検出
* ユーザー名、メッセージ本文、メッセージIDなどをDOMから解析して取得
* `MutationObserver` を使用して動的読み込みに対応

---

## 🔐 セキュリティ要件

* Webhook URLは `chrome.storage.local` に保存
* Discord Webhook以外への通信は禁止
* メッセージ送信時に以下を考慮：

  * 他人のメッセージは送信前に確認ダイアログを表示
  * 送信ログや履歴は保存しない

---

## 🧪 テスト項目（抜粋）

* [ ] Webhook URLが保存・取得できる
* [ ] すべてのメッセージにボタンが挿入される
* [ ] クリック時にメッセージ内容が正しく抽出される
* [ ] Discordに正しい形式で送信される
* [ ] 他ユーザーのメッセージ送信時に警告が表示される
* [ ] 動的読み込みのメッセージにも対応する

---

## 🧩 ユーザーフロー

1. Chrome拡張をインストール
2. 拡張アイコンをクリックし、popup.htmlでWebhook URLを入力・保存
3. `https://discord.com/channels/` にアクセス
4. 各メッセージに「Send via Webhook」ボタンが表示される
5. ボタンをクリック → Webhook経由で送信
6. 成功 or 失敗の通知が表示される

---

## 📌 Claude への指示例

Claude、上記のMarkdown形式の要件定義に従って、Chrome拡張（Manifest V3）を作成してください。
まずは以下の機能を実装してください：

* 各Discordメッセージに「Send via Webhook」ボタンを追加（DOM挿入）
* クリック時にメッセージの本文とリンクを取得
* 抽出したデータを指定されたDiscord Webhookに送信
* popup.html で Webhook URL の保存・取得も実装

```

